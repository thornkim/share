<script>
    const urlParams = new URLSearchParams(window.location.search);
    const data = urlParams.get('data');
    const playStoreUrl = "https://play.google.com/store/apps/details?id=your.package.name";

    if (data) {
        const deepLink = "myschedule://share?data=" + data;
        document.getElementById('manual-link').href = deepLink;

        // 1. 앱 실행 시도
        window.location.href = deepLink;

        // 2. 앱 실행 후 브라우저 처리 로직
        const start = Date.now();
        
        setTimeout(() => {
            const now = Date.now();
            
            // 앱 실행 성공 시: 사용자가 앱에 머물다 돌아왔으므로 시간이 많이 경과함 (약 3초 이상)
            if (now - start > 3000) {
                // 카카오톡 인앱 브라우저 전용 닫기 시도
                location.href = "kakaotalk://inappbrowser/close";
                // 일반 브라우저용 닫기
                window.close();
            } 
            // 앱 실행 실패 시: 브라우저에 계속 머물러 있어 시간이 짧게 경과함
            else {
                if (confirm("앱이 설치되어 있지 않은 것 같습니다. 설치 페이지로 이동할까요?")) {
                    window.location.href = playStoreUrl;
                }
            }
        }, 2500);

    } else {
        document.body.innerHTML = "<h2>잘못된 접근입니다.</h2>";
    }
</script>
